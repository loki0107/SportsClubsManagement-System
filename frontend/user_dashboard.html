<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Dashboard</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&family=Inter:wght@400;600&display=swap");
      body {
        font-family: "Inter", "Montserrat", "Segoe UI", Tahoma, Geneva, Verdana,
          sans-serif;
        background: linear-gradient(
          135deg,
          #181c2b 0%,
          #232526 50%,
          #0f2027 100%
        );
        background-size: 400% 400%;
        animation: gradientBG 18s ease infinite;
        color: #f5f6fa;
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }
      @keyframes gradientBG {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      header {
        background: rgba(30, 30, 40, 0.92);
        backdrop-filter: blur(12px) saturate(180%);
        box-shadow: 0 4px 24px 0 rgba(31, 38, 135, 0.1);
        color: #ffb366;
        padding: 28px 32px 18px 32px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-radius: 0 0 32px 32px;
        margin-bottom: 0;
        font-family: "Montserrat", "Inter", sans-serif;
        animation: fadeInDown 1.1s cubic-bezier(0.77, 0, 0.18, 1);
      }
      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-40px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .logout-btn {
        background: linear-gradient(90deg, #ff6b00 0%, #ff8c00 100%);
        color: white;
        border: none;
        padding: 12px 28px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.08rem;
        font-family: "Montserrat", "Inter", sans-serif;
        font-weight: 700;
        box-shadow: 0 4px 24px rgba(255, 107, 0, 0.18);
        transition: transform 0.18s, box-shadow 0.18s, background 0.18s;
        position: relative;
        overflow: hidden;
        letter-spacing: 1px;
      }
      .logout-btn::after {
        content: "";
        position: absolute;
        left: 50%;
        top: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.18);
        border-radius: 100%;
        transform: translate(-50%, -50%);
        transition: width 0.4s ease, height 0.4s ease;
        z-index: 0;
      }
      .logout-btn:active::after {
        width: 220px;
        height: 220px;
      }
      .logout-btn:hover {
        background: linear-gradient(90deg, #ff8c00 0%, #ff6b00 100%);
        transform: translateY(-2px) scale(1.03);
        box-shadow: 0 8px 32px rgba(255, 107, 0, 0.25);
      }
      .main-content {
        max-width: 1200px;
        margin: 36px auto 0 auto;
        padding: 32px 24px 24px 24px;
        background: rgba(30, 30, 40, 0.92);
        border-radius: 32px;
        box-shadow: 0 12px 48px 0 rgba(31, 38, 135, 0.25);
        animation: fadeIn 1.2s cubic-bezier(0.77, 0, 0.18, 1);
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(40px) scale(0.98);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      h2 {
        font-family: "Montserrat", "Inter", sans-serif;
        font-size: 2rem;
        font-weight: 700;
        color: #ffb366;
        margin-bottom: 18px;
        letter-spacing: 1px;
        text-shadow: 0 2px 12px #000a;
        animation: fadeIn 1.2s cubic-bezier(0.77, 0, 0.18, 1);
      }
      p {
        font-size: 1.15rem;
        color: #e0e0e0;
        margin-bottom: 32px;
        font-family: "Inter", sans-serif;
        animation: fadeIn 1.3s cubic-bezier(0.77, 0, 0.18, 1);
      }
      .card-container {
        display: flex;
        flex-wrap: wrap;
        gap: 32px;
        justify-content: center;
        margin-bottom: 36px;
        animation: fadeIn 1.4s cubic-bezier(0.77, 0, 0.18, 1);
      }
      .card {
        flex: 1 1 220px;
        min-width: 220px;
        max-width: 260px;
        background: rgba(40, 40, 50, 0.98);
        border-radius: 18px;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
        padding: 28px 18px 22px 18px;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: transform 0.25s, box-shadow 0.25s;
        cursor: pointer;
        animation: fadeInUp 1.2s cubic-bezier(0.77, 0, 0.18, 1);
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(40px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .card h3 {
        font-family: "Montserrat", "Inter", sans-serif;
        font-size: 1.25rem;
        font-weight: 700;
        color: #ffb366;
        margin-bottom: 10px;
        letter-spacing: 0.5px;
      }
      .card p {
        color: #e0e0e0;
        font-size: 1rem;
        margin-bottom: 18px;
        font-family: "Inter", sans-serif;
      }
      .view-btn {
        background: linear-gradient(90deg, #ff6b00 0%, #ff8c00 100%);
        color: white;
        border: none;
        padding: 10px 22px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-family: "Montserrat", "Inter", sans-serif;
        font-weight: 600;
        box-shadow: 0 4px 16px rgba(255, 107, 0, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
        position: relative;
        overflow: hidden;
        margin-top: 8px;
        letter-spacing: 0.5px;
      }
      .view-btn::after {
        content: "";
        position: absolute;
        left: 50%;
        top: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.18);
        border-radius: 100%;
        transform: translate(-50%, -50%);
        transition: width 0.4s ease, height 0.4s ease;
        z-index: 0;
      }
      .view-btn:active::after {
        width: 180px;
        height: 180px;
      }
      .view-btn:hover {
        background: linear-gradient(90deg, #ff8c00 0%, #ff6b00 100%);
        transform: translateY(-2px) scale(1.03);
        box-shadow: 0 8px 32px rgba(255, 107, 0, 0.18);
      }
      section {
        background: rgba(30, 30, 40, 0.92);
        border-radius: 18px;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.13);
        padding: 28px 18px 18px 18px;
        margin-bottom: 32px;
        animation: fadeInSection 1.2s cubic-bezier(0.77, 0, 0.18, 1);
      }
      @keyframes fadeInSection {
        from {
          opacity: 0;
          transform: translateX(40px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      h3 {
        font-family: "Montserrat", "Inter", sans-serif;
        font-size: 1.15rem;
        font-weight: 700;
        color: #ffb366;
        margin-bottom: 16px;
        letter-spacing: 0.5px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
        background: rgba(40, 40, 50, 0.98);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(44, 62, 80, 0.08);
        animation: fadeIn 1.2s cubic-bezier(0.77, 0, 0.18, 1);
      }
      th,
      td {
        padding: 14px 18px;
        text-align: left;
        border-bottom: 1px solid #333;
        font-size: 1rem;
        color: #f5f6fa;
        font-family: "Inter", sans-serif;
      }
      th {
        background: rgba(44, 62, 80, 0.27);
        color: #ffb366;
        font-weight: bold;
      }
      tr {
        transition: background 0.2s, box-shadow 0.2s;
      }
      tr:hover {
        background: #232526;
        box-shadow: 0 2px 8px rgba(44, 62, 80, 0.18);
      }
      @media (max-width: 900px) {
        .main-content {
          padding: 12px 2px 12px 2px;
          border-radius: 18px;
          max-width: 98vw;
        }
        .card-container {
          gap: 12px;
        }
        section {
          padding: 12px 2px 12px 2px;
          border-radius: 12px;
        }
      }
      @media (max-width: 600px) {
        .main-content {
          margin: 8px 2px 8px 2px;
          padding: 8px 2px 8px 2px;
          border-radius: 12px;
        }
        header {
          border-radius: 0;
          padding: 14px 8px 8px 8px;
        }
        .card-container {
          flex-direction: column;
          gap: 8px;
        }
        section {
          padding: 8px 2px 8px 2px;
          border-radius: 8px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h2>User Dashboard</h2>
      <button class="logout-btn" onclick="window.location.href='index.html'">
        Logout
      </button>
    </header>

    <div class="main-content">
      <h2>Welcome, User!</h2>
      <p>View sports club information and upcoming events</p>

      <div class="card-container">
        <div class="card">
          <h3>Upcoming Matches</h3>
          <p>View the schedule of upcoming matches and tournaments</p>
          <button class="view-btn" onclick="window.location.href='#matches'">
            View Matches
          </button>
        </div>

        <div class="card">
          <h3>Team Rosters</h3>
          <p>See all players and coaches for each team</p>
          <button class="view-btn" onclick="window.location.href='#teams'">
            View Teams
          </button>
        </div>

        <div class="card">
          <h3>Tournaments</h3>
          <p>Check out current and upcoming tournaments</p>
          <button
            class="view-btn"
            onclick="window.location.href='#tournaments'"
          >
            View Tournaments
          </button>
        </div>

        <div class="card">
          <h3>Fans</h3>
          <p>See registered fans and their favorite teams</p>
          <button class="view-btn" onclick="window.location.href='#fans'">
            View Fans
          </button>
        </div>

        <div class="card">
          <h3>Equipment</h3>
          <p>View available sports equipment and inventory</p>
          <button class="view-btn" onclick="window.location.href='#equipment'">
            View Equipment
          </button>
        </div>
      </div>

      <div id="allTables">
        <section id="players">
          <h3>Players</h3>
          <table id="playersTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Team</th>
                <th>Position</th>
                <th>Contact</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <section id="teams">
          <h3>Teams</h3>
          <table id="teamsTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Coach</th>
                <th>Sport Type</th>
                <th>Home Ground</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <section id="coaches">
          <h3>Coaches</h3>
          <table id="coachesTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Experience</th>
                <th>Specialization</th>
                <th>Salary</th>
                <th>Contact</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <section id="matches">
          <h3>Matches</h3>
          <table id="matchesTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Tournament</th>
                <th>Date</th>
                <th>Team 1</th>
                <th>Team 2</th>
                <th>Venue</th>
                <th>Result</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <section id="tournaments">
          <h3>Tournaments</h3>
          <table id="tournamentsTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Location</th>
                <th>Prize</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <section id="fans">
          <h3>Fans</h3>
          <table id="fansTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Favorite Team</th>
                <th>Membership</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <section id="tickets">
          <h3>Tickets</h3>
          <table id="ticketsTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Match</th>
                <th>Buyer</th>
                <th>Seat</th>
                <th>Price</th>
                <th>Purchase Date</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>

        <section id="equipment">
          <h3>Equipment</h3>
          <table id="equipmentTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Quantity</th>
                <th>Condition</th>
                <th>Purchase Date</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </section>
      </div>
    </div>

    <script>
      // Cache for team and tournament names
      let teamsCache = [];
      let tournamentsCache = [];

      async function loadTeamsCache() {
        const res = await fetch("/api/public/teams");
        const data = await res.json();
        teamsCache = data.teams;
      }

      async function loadTournamentsCache() {
        const res = await fetch("/api/public/tournaments");
        const data = await res.json();
        tournamentsCache = data.tournaments;
      }

      function getTeamNameById(id) {
        const team = teamsCache.find((t) => t.team_id == id);
        return team ? team.team_name : id;
      }

      function getTournamentNameById(id) {
        const t = tournamentsCache.find((t) => t.tournament_id == id);
        return t ? t.tournament_name : id;
      }

      async function fetchAndDisplay(url, tableId, rowFn) {
        try {
          const res = await fetch(url);
          const data = await res.json();
          const tbody = document.querySelector(`#${tableId} tbody`);
          tbody.innerHTML = "";
          const dataArray = Array.isArray(data)
            ? data
            : data[Object.keys(data)[0]];
          dataArray.forEach((row) => {
            tbody.innerHTML += rowFn(row);
          });
        } catch (error) {
          console.error(`Error loading ${tableId}:`, error);
        }
      }

      window.onload = async function () {
        // Load caches first
        await loadTeamsCache();
        await loadTournamentsCache();

        // Players
        await fetchAndDisplay(
          "/api/public/players",
          "playersTable",
          (p) => `
            <tr>
              <td>${p.player_id}</td>
              <td>${p.name}</td>
              <td>${p.age || ""}</td>
              <td>${p.gender || ""}</td>
              <td>${getTeamNameById(p.team_id) || ""}</td>
              <td>${p.position || ""}</td>
              <td>${p.contact_info || ""}</td>
            </tr>`
        );

        // Teams
        await fetchAndDisplay(
          "/api/public/teams",
          "teamsTable",
          (t) => `
            <tr>
              <td>${t.team_id}</td>
              <td>${t.team_name}</td>
              <td>${t.coach_name || t.coach_id || ""}</td>
              <td>${t.sport_type || ""}</td>
              <td>${t.home_ground || ""}</td>
            </tr>`
        );

        // Coaches
        await fetchAndDisplay(
          "/api/public/coaches",
          "coachesTable",
          (c) => `
            <tr>
              <td>${c.coach_id}</td>
              <td>${c.name}</td>
              <td>${c.experience_years || c.experience || ""}</td>
              <td>${c.specialization || ""}</td>
              <td>${c.salary ? "$" + c.salary.toLocaleString() : ""}</td>
              <td>${c.contact_info || ""}</td>
            </tr>`
        );

        // Matches
        await fetchAndDisplay(
          "/api/public/matches",
          "matchesTable",
          (m) => `
            <tr>
              <td>${m.match_id}</td>
              <td>${getTournamentNameById(m.tournament_id) || ""}</td>
              <td>${m.match_date ? m.match_date.split("T")[0] : ""}</td>
              <td>${getTeamNameById(m.team1_id) || ""}</td>
              <td>${getTeamNameById(m.team2_id) || ""}</td>
              <td>${m.venue || ""}</td>
              <td>${m.result || ""}</td>
            </tr>`
        );

        // Tournaments
        await fetchAndDisplay(
          "/api/public/tournaments",
          "tournamentsTable",
          (t) => `
            <tr>
              <td>${t.tournament_id}</td>
              <td>${t.tournament_name}</td>
              <td>${t.start_date || ""}</td>
              <td>${t.end_date || ""}</td>
              <td>${t.location || ""}</td>
              <td>${
                t.prize_amount ? "$" + t.prize_amount.toLocaleString() : ""
              }</td>
            </tr>`
        );

        // Fans
        await fetchAndDisplay(
          "/api/public/fans",
          "fansTable",
          (f) => `
            <tr>
              <td>${f.fan_id}</td>
              <td>${f.name}</td>
              <td>${f.email || ""}</td>
              <td>${f.phone_number || ""}</td>
              <td>${getTeamNameById(f.favorite_team) || ""}</td>
              <td>${f.membership_level || ""}</td>
            </tr>`
        );

        // Tickets
        await fetchAndDisplay(
          "/api/public/tickets",
          "ticketsTable",
          (t) => `
            <tr>
              <td>${t.ticket_id}</td>
              <td>${getTournamentNameById(t.match_id) || ""}</td>
              <td>${t.buyer_name || ""}</td>
              <td>${t.seat_number || ""}</td>
              <td>${t.price ? "$" + t.price.toLocaleString() : ""}</td>
              <td>${t.purchase_date ? t.purchase_date.split("T")[0] : ""}</td>
            </tr>`
        );

        // Equipment
        await fetchAndDisplay(
          "/api/public/equipment",
          "equipmentTable",
          (e) => `
            <tr>
              <td>${e.equipment_id}</td>
              <td>${e.equipment_name}</td>
              <td>${e.quantity || ""}</td>
              <td>${e.condition_status || ""}</td>
              <td>${e.purchase_date || ""}</td>
            </tr>`
        );
      };
    </script>
  </body>
</html>
